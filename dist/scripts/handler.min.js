"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",emailStore:"/dist/scripts/components/email-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min",utils:"/dist/scripts/utils/utils",simditor:"/statics/libs/simditor/dist/simditor",simditorModule:"/statics/libs/simditor/dist/module",simditorHotkeys:"/statics/libs/simditor/dist/hotkeys",simditorUploader:"/statics/libs/simditor/dist/uploader",editor:"/dist/scripts/components/editor"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","validator","userStore","emailStore","axios","bootstrap","toast","editor"],function(t,e,o,i,a,s,n,r,d,l){function c(t){var e=t.index();e!==A.index()&&(A.removeClass("active"),A=t,A.addClass("active"),0===e&&X?_({},C).then(function(t){m(C),p(t.data,C),X=!1}):P&&_({},j).then(function(t){m(j),p(t.data,j),P=!1}))}function m(t){var e=t===C?F:N;e.empty()}function p(t,e){var i,a=e===C?F:N,s=e!==C?F:N,n=[];s.fadeOut(100),console.log(t),t=t.count>0?t.mailList:[],t.length>0?t.forEach(function(t){i=G(t),n.push(i),a.append(o(i))}):(K.fadeIn(500),J.append(K))}function u(t,e){e.tags=e.tags?e.tags.split("|"):[],f=t,v=e,R.html(e.subject),V.html(e.fromAddress),W.html(e.body),Y.html(e.receiveDate),Z.empty(),e.tags&&e.tags.length>0&&e.tags.forEach(function(t){h(t)})}function _(t,e){return K.detach(),O.fadeIn(200),s.getEmails(t,e).then(function(t){return O.fadeOut(300),t})}function h(t){var e=o("<div>"),i=o("<span>");e.addClass("email__tag label label-primary inline-block"),e.attr("data-tag",t),i.text(t),e.append(i),Z.append(e)}var f,v,b=".",g="--active",w="tab-navs__item",y="main-body__tab",j="handled",C="unhandled",x="show",k="hide",q=y+g,T=w+g,E=o(".tab-navs"),I=o(b+y),S=o(b+T),D=o(b+q),O=o(".loader-indicator"),z=o(".handler-viewer__type-switcher-holder"),A=o(".handler-viewer__type-switcher.active"),H=o(".email-rows"),F=o(".handler-viewer__un-handled-table-body"),N=o(".handler-viewer__handled-table-body"),P=!0,X=!0,L="成功",M="失败",U="为空",B="处理人员"+U,G=e.template(o("#tpl__email").html()),J=o(".handler-viewer__email-table-holder"),K=o(o("#tpl__empty").html()),Q=o("#modal__email-viewer"),R=o(".modal__email-topic"),V=o(".modal__email-sender"),W=o(".modal__email-content"),Y=o(".modal__email-sent-at"),Z=o(".email__tags-holder"),$=o("#email__assessor-selector"),tt=o(".modal__confirm-btn"),et=(o(".email__handler-editor-wrapper"),o("#email-creator-wrapper")),ot=new l("#email-editor");setTimeout(function(){o(window).resize()},20),window.editor=ot,E.on("click",".tab-navs__item",function(t){t.preventDefault();var e,i=o(t.target);i.is(b+T)||(i.addClass(T),S.length>0&&S.removeClass(T),D.length>0&&D.removeClass(q),S=i,e=i.index(),D=I.eq(i.index()),D.addClass(q),1===e&&et.append(o(".simditor")))}),H.on("click","tr",function(t){var e=o(t.currentTarget);O.fadeIn(200),s.getEmail({id:e.data("id")}).then(function(t){t=t.data,console.log(t),Q.modal(x),u(e,t),O.fadeOut(200)},function(t){console.log(t)})}),_({},C).then(function(t){t=t.data,p(t,C),X=!1}),z.on("click",".handler-viewer__type-switcher",function(t){var e=o(t.target);c(e)}),tt.on("click",function(){var t=$.val(),e="-1"===t?B:void 0;e?d.show(e):(v.handler_id=handlerId,v.isDispatched="1",v.tags="string"==typeof v.tags?v.tags:v.tags.join("|"),console.log(v),s.updateEmail(v).then(function(t){d.show(DISPATCH_TEXT+L),Q.modal(k),f.remove(),console.log(t)},function(t){d.show(DISPATCH_TEXT+M),console.log(t)}))}),tt.on("click",function(){d.show("处理成功")})});