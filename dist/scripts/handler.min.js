"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",emailStore:"/dist/scripts/components/email-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min",utils:"/dist/scripts/utils/utils",simditor:"/statics/libs/simditor/dist/simditor",simditorModule:"/statics/libs/simditor/dist/module",simditorHotkeys:"/statics/libs/simditor/dist/hotkeys",simditorUploader:"/statics/libs/simditor/dist/uploader",editor:"/dist/scripts/components/editor"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","validator","userStore","emailStore","axios","bootstrap","toast","editor"],function(t,e,o,a,i,s,n,r,d,l){function c(t){var e=t.index();e!==A.index()&&(A.removeClass("active"),A=t,A.addClass("active"),0===e&&P?h({},C).then(function(t){m(C),p(C,t.data),P=!1}):N?h({},j).then(function(t){m(j),p(j,t.data),N=!1}):p(0===e?C:j))}function m(t){var e=t===C?F:L;e.empty()}function p(t,e){var a,i=t===C?F:L,s=t!==C?F:L,n=[];s.fadeOut(100),i.fadeIn(100),console.log(e),void 0!=e?(console.log(e),e.count>0?(e=e.mailList,e.forEach(function(t){a=G(t),n.push(a),i.append(o(a))})):(K.fadeIn(500),J.append(K))):i.children().length>0?K.fadeOut(100):K.fadeIn(100)}function u(t,e){e.tags=e.tags?e.tags.split("|"):[],f=t,v=e,R.html(e.subject),V.html(e.fromAddress),W.html(e.body),Y.html(e.receiveDate),Z.empty(),e.tags&&e.tags.length>0&&e.tags.forEach(function(t){_(t)})}function h(t,e){return K.detach(),D.fadeIn(200),s.getEmails(t,e).then(function(t){return D.fadeOut(300),t})}function _(t){var e=o("<div>"),a=o("<span>");e.addClass("email__tag label label-primary inline-block"),e.attr("data-tag",t),a.text(t),e.append(a),Z.append(e)}var f,v,g=".",b="--active",w="tab-navs__item",y="main-body__tab",j="handled",C="unhandled",x="show",k="hide",q=y+b,E=w+b,I=o(".tab-navs"),T=o(g+y),O=o(g+E),S=o(g+q),D=o(".loader-indicator"),z=o(".handler-viewer__type-switcher-holder"),A=o(".handler-viewer__type-switcher.active"),H=o(".email-rows"),F=o(".handler-viewer__un-handled-table-body"),L=o(".handler-viewer__handled-table-body"),N=!0,P=!0,X="成功",M="失败",U="为空",B="处理人员"+U,G=e.template(o("#tpl__email").html()),J=o(".handler-viewer__email-table-holder"),K=o(o("#tpl__empty").html()),Q=o("#modal__email-viewer"),R=o(".modal__email-topic"),V=o(".modal__email-sender"),W=o(".modal__email-content"),Y=o(".modal__email-sent-at"),Z=o(".email__tags-holder"),$=o("#email__assessor-selector"),tt=o(".modal__confirm-btn"),et=[],ot=(o(".email__handler-editor-wrapper"),o("#email-creator-wrapper")),at=new l("#email-editor");setTimeout(function(){o(window).resize()},20),window.editor=at,I.on("click",".tab-navs__item",function(t){t.preventDefault();var e,a=o(t.target);a.is(g+E)||(a.addClass(E),O.length>0&&O.removeClass(E),S.length>0&&S.removeClass(q),O=a,e=a.index(),S=T.eq(a.index()),S.addClass(q),1===e&&ot.append(o(".simditor")))}),H.on("click","tr",function(t){var e=o(t.currentTarget);D.fadeIn(200),s.getEmail({id:e.data("id")}).then(function(t){t=t.data,console.log(t),Q.modal(x),u(e,t),D.fadeOut(200)},function(t){console.log(t)})}),h({},C).then(function(t){t=t.data,p(C,t),P=!1}),z.on("click",".handler-viewer__type-switcher",function(t){var e=o(t.target);c(e)}),i.getAssessors().then(function(t){console.log(t),t=t.data.assessorList,et=et.concat(t);var e;et.forEach(function(t){e=o("<option>"),e.text(t.name),e.val(t.id),$.append(e)})}),tt.on("click",function(){var t=$.val(),e="-1"===t?B:void 0;e?d.show(e):(v.handler_id=handlerId,v.isDispatched="1",v.tags="string"==typeof v.tags?v.tags:v.tags.join("|"),console.log(v),s.updateEmail(v).then(function(t){d.show(DISPATCH_TEXT+X),Q.modal(k),f.remove(),console.log(t)},function(t){d.show(DISPATCH_TEXT+M),console.log(t)}))}),tt.on("click",function(){d.show("处理成功")})});