"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min",utils:"/dist/scripts/utils/utils"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","validator","userStore","axios","bootstrap","toast"],function(e,t,o,a,s,r,n,i){function d(e,t){var o=e.find(".form__error").eq(0);o.html(t),o.show()}function l(e){var t=e.find(".form__error").eq(0);t.hide()}function c(e){var t=o("<div>"),a=o("<img>");return t.addClass("user"),a.addClass("img-circle user__avatar"),a.attr("src",e.avatar),t.append(a),t.append(o("<span>").text(e.username)),t}function u(e,t){var o,a;if(e=e||[],a=e.length,t=t||H,console.log(e),a>0)for(var s=0;a>s;s++)o=c(e[s]),t.append(o);else console.log(a),t.append(X)}function p(e){G.removeClass("active"),H.removeClass("active"),G=P.eq(e),H=U.eq(e),G.addClass("active"),H.addClass("active"),0===H.children().length&&v({role:G.data("type")}).then(function(e){console.log(e),e=e.data&&e.data.list,u(e,H)},function(e){console.log(e)})}function m(){return r.get(e.API.conf.email)}function v(e){return B.fadeIn(200),s.getUsers(e).then(function(e){return B.fadeOut(300),e})}{var _=".",f="--active",w="tab-navs__item",h="main-body__tab",g=h+f,b=w+f,C=o(".tab-navs"),q=o(_+h),y=o(_+b),j=o(_+g),x=o(".form__mail-conf"),D=o("#email__address"),k=o("#email__password"),z=o("#email__password-confirmation"),I=o(".form__user-creation"),O=o("#user-creation__username"),A=o("#user-creation__password"),E=o("#user-creation__password-confirmation"),F=o("#user-creation__type"),N=o(".user-viewer__type-switcher-holder"),P=N.children(),S=o(".user-viewer"),U=o(".user-viewer__list"),B=(o(".user-viewer__holder"),o(".loader-indicator")),G=o(".user-viewer__type-switcher.active"),H=o(".user-viewer__list.active"),J="密码有误",K="确认密码不一致",L="用户名有误",M="请选择用户类型",Q="邮箱配置",R="成功",T="失败",V={},W=o("#tpl__pagination").html(),X=o("#tpl__empty").html();t.template(W)}C.on("click",function(e){e.preventDefault();var t,a=o(e.target);a.is(_+b)||(a.addClass(b),y.length>0&&y.removeClass(b),j.length>0&&j.removeClass(g),y=a,t=a.index(),j=q.eq(a.index()),j.addClass(g))}),x.on("submit",function(o){o.preventDefault();var s={address:D.val(),password:k.val(),passwordConfirmation:z.val()},n=a.isEmail(s.address)?void 0:K;n=n||(!s.password||s.password.length<6?J:void 0),n=n||(s.password!==s.passwordConfirmation?K:void 0),n?d(x,n):r.put(e.API.conf.email,t.merge({},V.email,s)).then(function(e){e=e.data,e&&e._id&&(V.email=t.merge({},V.email,e),i.show(Q+R))},function(e){i.show(Q+T)})}),[x,I].forEach(function(e){e.on("input",function(t){l(e)})}),I.on("submit",function(e){e.preventDefault();var t={username:O.val(),password:A.val(),passwordConfirmation:E.val(),role:F.val()},o=!t.username||t.username.length<4?L:void 0;o=o||(!t.password||t.password.length<4?J:void 0),o=o||(t.password!==t.passwordConfirmation?K:void 0),o=o||(t.role?void 0:M),o?d(I,o):s.create(t).then(function(e){i.show("成功创建用户")},function(e){})}),S.on("click",".user-viewer__type-switcher",function(e){var t=o(e.target),a=t.index();a!==G.index()&&p(a)}),S.on("click","",function(e){e.preventDefault()}),m().then(function(e){e=e.data[0],e&&e.address&&(V.email=e,D.val(e.address))}),v({role:"dispatcher"}).then(function(e){u(e.data&&e.data.list)})});