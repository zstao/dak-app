"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min",utils:"/dist/scripts/utils/utils"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","utils","validator","userStore","axios","bootstrap","toast"],function(e,a,s,t,o,r,i,n,d){function l(e,a){var s=e.find(".form__error").eq(0);s.html(a),s.show()}function c(e){var a=e.find(".form__error").eq(0);a.hide()}function m(e){var a=s("<div>"),t=s("<img>");return a.addClass("user"),t.addClass("img-circle user__avatar"),t.attr("src",e.avatar),a.append(t),a.append(s("<span>").text(e.username)),a}function p(e,a){var s,t;if(e=e||[],t=e.length,a=a||V,console.log(e),t>0)for(var o=0;t>o;o++)s=m(e[o]),a.append(s);else a.append($)}function u(e){U.removeClass("active"),V.removeClass("active"),U=R.eq(e),V=M.eq(e),U.addClass("active"),V.addClass("active"),0===V.children().length&&v({role:U.data("type")}).then(function(e){p(e.data,V)},function(e){console.log(e)})}function _(){return i.get(t.appendQueries(e.API.conf.email,{uid:window.sessionStorage.getItem("user_id")}))}function v(e){return Q.fadeIn(200),r.getUsers(e).then(function(e){return Q.fadeOut(300),e})}{var f=".",w="--active",h="tab-navs__item",g="main-body__tab",b=g+w,C=h+w,q=s(".tab-navs"),y=s(f+g),j=s(f+C),x=s(f+b),I=s(".form__mail-conf"),D=s("#email__address"),A=s("#email__imap-address"),P=s("#email__password"),k=s("#email__password-confirmation"),z=s(".form__user-creation"),E=s("#user-creation__username"),N=s("#user-creation__password"),O=s("#user-creation__password-confirmation"),S=s("#user-creation__type"),F=s(".user-viewer__type-switcher-holder"),R=F.children(),L=s(".user-viewer"),M=s(".user-viewer__list"),Q=(s(".user-viewer__holder"),s(".loader-indicator")),U=s(".user-viewer__type-switcher.active"),V=s(".user-viewer__list.active"),W="IMAP地址有误",B="密码有误",G="确认密码不一致",H="用户名有误",J="请选择用户类型",K="邮箱配置",T="成功",X="失败",Y={},Z=s("#tpl__pagination").html(),$=s("#tpl__empty").html();a.template(Z)}q.on("click",".tab-navs__item",function(e){e.preventDefault();var a,t=s(e.target);t.is(f+C)||(t.addClass(C),j.length>0&&j.removeClass(C),x.length>0&&x.removeClass(b),j=t,a=t.index(),x=y.eq(t.index()),x.addClass(b))}),I.on("submit",function(s){s.preventDefault();var t={email_address:D.val(),imap_address:A.val(),password:P.val(),passwordConfirmation:k.val()},r=o.isEmail(t.email_address)?void 0:G;r=r||(t.imap_addressERR_PWD_INVALID?void 0:W),r=r||(!t.password||t.password.length<6?B:void 0),r=r||(t.password!==t.passwordConfirmation?G:void 0),r?l(I,r):i.put(e.API.conf.email,a.merge({},Y.email,t)).then(function(e){e=e.data,e&&(Y.email=a.merge({},Y.email,e),d.show(K+T))},function(e){d.show(K+X)})}),[I,z].forEach(function(e){e.on("input",function(a){c(e)})}),z.on("submit",function(e){e.preventDefault();var a={name:E.val(),password:N.val(),passwordConfirmation:O.val(),role:S.val()},s=!a.name||a.name.length<4?H:void 0;s=s||(!a.password||a.password.length<4?B:void 0),s=s||(a.password!==a.passwordConfirmation?G:void 0),s=s||(a.role?void 0:J),s?l(z,s):r.create(a).then(function(e){e=e.data,e&&e.message?l(z,e.message):d.show("成功创建用户")},function(e){})}),L.on("click",".user-viewer__type-switcher",function(e){var a=s(e.target),t=a.index();t!==U.index()&&u(t)}),L.on("click","",function(e){e.preventDefault()}),_().then(function(e){e=e.data,console.log(e),e&&e.email_address&&(Y.email=e,D.val(e.email_address),A.val(e.imap_address),P.val(e.password))}),v({role:"dispatcher"}).then(function(e){p(e.data)})});