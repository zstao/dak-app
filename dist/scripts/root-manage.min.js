"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","validator","userStore","axios","bootstrap","toast"],function(e,o,s,t,r,a,n,i){function d(e,o){var s=e.find(".form__error").eq(0);s.html(o),s.show()}function c(e){var o=e.find(".form__error").eq(0);o.hide()}function l(e){var o=s("<div>");return o.addClass("user"),o.append(s("<span>").text(e.username)),o}function u(e){var o;console.log(e);for(var s=0,t=e.length;t>s;s++)o=l(e[s]),B.append(o)}function p(e){U.removeClass("active"),B.removeClass("active"),U=P.eq(e),B=S.eq(e),U.addClass("active"),B.addClass("active")}function v(){return a.get(e.API.email.root)}var m=".",_="--active",f="tab-navs__item",w="main-body__tab",h=w+_,b=f+_,g=s(".tab-navs"),C=s(m+w),q=s(m+b),y=s(m+h),j=s(".form__mail-conf"),x=s("#email__address"),z=s("#email__password"),D=s("#email__password-confirmation"),O=s(".form__user-creation"),k=s("#user-creation__username"),A=s("#user-creation__password"),F=s("#user-creation__password-confirmation"),I=s("#user-creation__type"),N=s(".user-viewer__type-switcher-holder"),P=N.children(),S=s(".user-viewer__list"),E=(s(".user-viewer__holder"),s(".loader-indicator")),U=s(".user-viewer__type-switcher.active"),B=s(".user-viewer__list.active"),G="密码有误",H="确认密码不一致",J="用户名有误",K="请选择用户类型";g.on("click",function(e){e.preventDefault();var o,t=s(e.target);t.is(m+b)||(t.addClass(b),q.length>0&&q.removeClass(b),y.length>0&&y.removeClass(h),q=t,o=t.index(),y=C.eq(t.index()),y.addClass(h))}),j.on("submit",function(o){o.preventDefault();var s={address:x.val(),password:z.val(),passwordConfirmation:D.val()},r=t.isEmail(s.address)?void 0:H;r=r||(!s.password||s.password.length<6?G:void 0),r=r||(s.password!==s.passwordConfirmation?H:void 0),r?d(j,r):(s.id="1",a.put(e.API.email.root,s).then(function(e){console.log(e)},function(e){console.log(e)}))}),j.on("input",function(e){c(j)}),O.on("submit",function(e){e.preventDefault();var o={username:k.val(),password:A.val(),passwordConfirmation:F.val(),type:I.val()},s=!o.username||o.username.length<4?J:void 0;s=s||(!o.password||o.password.length<4?G:void 0),s=s||(o.password!==o.passwordConfirmation?H:void 0),s=s||(o.type?void 0:K),s?d(O,s):r.create(o).then(function(e){i.show("成功创建用户")},function(e){}),console.log(o)}),N.on("click",".user-viewer__type-switcher",function(e){var o=s(e.target),t=o.index();t!==U.index()&&p(t)}),v().then(function(e){e=e.data,e&&e.address&&x.val(e.address)}),r.getUsers().then(function(e){E.fadeOut(500,function(){u(e.data)})},function(e){console.log(e)})});