"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",emailStore:"/dist/scripts/components/email-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min",utils:"/dist/scripts/utils/utils"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","validator","userStore","emailStore","axios","bootstrap","toast"],function(t,e,a,o,n,i,s,r,l){function d(t,e){return at.detach(),F.fadeIn(200),i.getEmails(t,e).then(function(t){return F.fadeOut(300),t})}function c(t){var e=t.index();e!==z.index()&&(z.removeClass("active"),z=t,z.addClass("active"),0===e&&T?d({},x).then(function(t){m(x),p(x,t.data),T=!1}):L?d({},y).then(function(t){m(y),p(y,t.data),L=!1}):p(0===e?x:y))}function m(t){var e=t===x?A:H;e.empty()}function p(t,e){var o,n=t===x?A:H,i=t!==x?A:H,s=[];i.hide(),n.show(),at.fadeOut(100),void 0!=e&&(e.count>0?(e=e.mailList,e.forEach(function(t){o=P(t),s.push(o),n.append(a(o))})):(at.fadeIn(500),et.append(at))),n.children().length>0?at.fadeOut(100):at.fadeIn(100)}function _(t,e){e.tags=e.tags?e.tags.split("|"):[],h=t,f=e,R.html(e.subject),U.html(e.fromAddress),W.html(e.body),V.html(e.receiveDate),X.empty(),e.tags&&e.tags.length>0&&e.tags.forEach(function(t){u(t)})}function u(t){var e=a("<div>"),o=a("<span>"),n=a("<span>");e.addClass("email__tag label label-primary inline-block"),n.addClass("email__tag-rm fa fa-times"),e.attr("data-tag",t),o.text(t),e.append(o),e.append(n),X.append(e)}var h,f,g=".",v="--active",b="tab-navs__item",w="main-body__tab",y="dispatched",x="undispatched",j="show",C="hide",q=w+v,O=b+v,k=a(".tab-navs"),E=a(g+w),D=a(g+O),I=a(g+q),S=a(".dispatcher-viewer__type-switcher-holder"),z=a(".dispatcher-viewer__type-switcher.active"),F=a(".loader-indicator"),N=a(".email-rows"),A=a(".dispatcher-viewer__un-dispatched-table-body"),H=a(".dispatcher-viewer__dispatched-table-body"),L=!0,T=!0,B="分发",G="成功",J="失败",K="为空",M="处理人员"+K,P=e.template(a("#tpl__email").html()),Q=a("#modal__email-viewer"),R=a(".modal__email-topic"),U=a(".modal__email-sender"),V=a(".modal__email-sent-at"),W=a(".modal__email-content"),X=a(".email__tags-holder"),Y=a(".email__tag-input-form"),Z=a("#email__tag-input"),$=(a("#email__tag-input-confirm-btn"),a("#email__handler-selector")),tt=(a(".modal__cancel-btn"),a(".modal__confirm-btn")),et=a(".dispatcher-viewer__email-table-holder"),at=a(a("#tpl__empty").html()),ot=[];k.on("click",".tab-navs__item",function(t){t.preventDefault();var e,o=a(t.target);o.is(g+O)||(o.addClass(O),D.length>0&&D.removeClass(O),I.length>0&&I.removeClass(q),D=o,e=o.index(),I=E.eq(o.index()),I.addClass(q))}),N.on("click","tr",function(t){var e=a(t.currentTarget);F.fadeIn(200),i.getEmail({id:e.data("id")}).then(function(t){t=t.data,console.log(t),Q.modal(j),_(e,t),F.fadeOut(200)},function(t){console.log(t)})}),d({},x).then(function(t){t=t.data,p(x,t),T=!1}),Y.on("submit",function(t){t.preventDefault();var e=Z.val();console.log(e),-1===f.tags.indexOf(e)&&(f.tags.push(e),Z.val(""),u(e))}),X.on("click",".email__tag-rm",function(t){var e=a(t.target),o=e.parent(),n=o.attr("data-tag"),i=f.tags.indexOf(n);f.tags.splice(i,1),console.log(o),console.log(n),o.remove()}),S.on("click",".dispatcher-viewer__type-switcher",function(t){var e=a(t.target);c(e)}),n.getHandlers().then(function(t){console.log(t),t=t.data,ot=ot.concat(t);var e;ot.forEach(function(t){e=a("<option>"),e.text(t.handler_name),e.val(t.handler_id),$.append(e)})}),tt.on("click",function(){var t=$.val(),e="-1"===t?M:void 0;e?l.show(e):(f.handler_id=t,f.isDispatched="1",f.tags="string"==typeof f.tags?f.tags:f.tags.join("|"),console.log(f),i.updateEmail(f).then(function(t){l.show(B+G),Q.modal(C),h.remove(),L=!0,console.log(t)},function(t){l.show(B+J),console.log(t)}))})});