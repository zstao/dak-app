"use strict";requirejs.config({paths:{axios:"/bower_components/axios/dist/axios.amd",CONF:"/dist/scripts/config",userStore:"/dist/scripts/components/user-store",emailStore:"/dist/scripts/components/email-store",jquery:"/bower_components/jquery/dist/jquery.min",zepto:"/bower_components/zepto/zepto.min",bootstrap:"/bower_components/bootstrap/dist/js/bootstrap.min",toast:"/dist/scripts/components/toast",_:"/bower_components/lodash/lodash.min",validator:"/bower_components/validator-js/validator.min",utils:"/dist/scripts/utils/utils"},shim:{bootstrap:{deps:["jquery"]}}}),requirejs(["CONF","_","jquery","validator","userStore","emailStore","axios","bootstrap","toast"],function(t,a,o,e,n,i,s,l,r){function c(t){return C.fadeIn(200),i.getEmails(t).then(function(t){return C.fadeOut(300),t})}function m(t){var a,e=[];t=t||[],console.log(t),t.forEach(function(t){a=E(t),e.push(a),console.log(a),k.append(o(a))})}function d(t,a){u=t,_=a,S.html(a.topic),z.html(a.sender),D.html(a.content),F.empty(),a.tags&&a.tags.length>0&&a.tags.forEach(function(t){p(t)})}function p(t){var a=o("<div>"),e=o("<span>"),n=o("<span>");a.addClass("email__tag label label-primary inline-block"),n.addClass("email__tag-rm fa fa-times"),a.attr("data-tag",t),e.text(t),a.append(e),a.append(n),F.append(a)}var u,_,f=".",g="--active",v="tab-navs__item",h="main-body__tab",b=h+g,j=v+g,w=o(".tab-navs"),x=o(f+h),q=o(f+j),y=o(f+b),C=o(".loader-indicator"),k=o(".email-rows"),E=a.template(o("#tpl__email").html()),O=o("#modal__email-viewer"),S=o(".modal__email-topic"),z=o(".modal__email-sender"),D=o(".modal__email-content"),F=o(".email__tags-holder"),I=o(".email__tag-input-form"),N=o("#email__tag-input"),T=(o("#email__tag-input-confirm-btn"),o("#email__handler-selector")),U=(o(".modal__cancel-btn"),o(".modal__confirm-btn")),A=[];w.on("click",function(t){t.preventDefault();var a,e=o(t.target);e.is(f+j)||(e.addClass(j),q.length>0&&q.removeClass(j),y.length>0&&y.removeClass(b),q=e,a=e.index(),y=x.eq(e.index()),y.addClass(b))}),k.on("click","tr",function(t){var a=o(t.currentTarget);C.fadeIn(200),i.getEmail(a.data("id")).then(function(t){t=t.data,console.log(t),O.modal(),d(a,t),C.fadeOut(200)},function(t){console.log(t)})}),c().then(function(t){m(t.data)}),I.on("submit",function(t){t.preventDefault();var a=N.val();console.log(a),-1===_.tags.indexOf(a)&&(_.tags.push(a),N.val(""),p(a))}),F.on("click",".email__tag-rm",function(t){var a=o(t.target),e=a.parent(),n=e.attr("data-tag");console.log(e),console.log(n),e.remove()}),n.getUsers({role:"handler"}).then(function(t){t=t.data.list,console.log(t),A=A.concat(t);var a;A.forEach(function(t){a=o("<option>"),a.text(t.username),a.val(t.id||t._id),T.append(a)})}),U.on("click",function(){r.show("分发成功")})});